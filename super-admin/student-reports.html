<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Report Cards - Super Admin</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"/>
    
    <!-- Include Database System -->
    <script src="../database.js"></script>
    
    <!-- Enhanced Report Card Styles -->
    <style>
        .student-search {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
            background: var(--secondary-color);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .search-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 200px;
        }

        .search-group label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .search-group select,
        .search-group input {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            background: var(--bg-darker);
            color: var(--text-color);
        }

        .search-group select:focus,
        .search-group input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.1);
        }

        .student-card {
            background: var(--secondary-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .student-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .student-info h3 {
            color: var(--text-color);
            margin-bottom: 5px;
            font-size: 1.4em;
        }

        .student-details {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .student-actions {
            display: flex;
            gap: 10px;
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .subject-card {
            background: var(--bg-darker);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid var(--border-color);
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .subject-name {
            font-weight: 600;
            color: var(--text-color);
            font-size: 16px;
        }

        .grade-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: white;
        }

        .grade-a { background: linear-gradient(135deg, #4CAF50, #8BC34A); }
        .grade-b { background: linear-gradient(135deg, #2196F3, #03A9F4); }
        .grade-c { background: linear-gradient(135deg, #FF9800, #FFC107); }
        .grade-d { background: linear-gradient(135deg, #FF5722, #F44336); }
        .grade-developing { background: linear-gradient(135deg, #9C27B0, #E91E63); }

        .skills-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .skill-item:last-child {
            border-bottom: none;
        }

        .skill-name {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .skill-rating {
            display: flex;
            gap: 2px;
        }

        .star {
            color: #FFD700;
            font-size: 12px;
        }

        .star.empty {
            color: var(--border-color);
        }

        .overall-summary {
            background: var(--bg-darker);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .teacher-comments {
            background: var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid var(--info-color);
        }

        .comment-header {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .comment-text {
            color: var(--text-secondary);
            font-size: 13px;
            line-height: 1.5;
        }

        .print-button {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .print-button:hover {
            background: #00b76a;
            transform: translateY(-1px);
        }

        .no-students {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .no-students i {
            font-size: 48px;
            color: var(--border-color);
            margin-bottom: 16px;
        }

        .term-selector {
            background: var(--bg-darker);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .term-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .term-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--secondary-color);
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .term-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .term-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        @media (max-width: 768px) {
            .report-grid {
                grid-template-columns: 1fr;
            }
            
            .student-search {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-group {
                min-width: auto;
            }
            
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Assessment Form Modal */
        .assessment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .assessment-modal-content {
            background: var(--secondary-color);
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            color: var(--text-color);
            font-size: 1.5em;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 5px;
        }

        .assessment-form {
            display: grid;
            gap: 20px;
        }

        .form-section {
            background: var(--bg-darker);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .form-section h4 {
            color: var(--text-color);
            margin: 0 0 15px 0;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-darker);
            color: var(--text-color);
            font-size: 14px;
        }

        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.1);
        }

        .skills-assessment {
            display: grid;
            gap: 15px;
        }

        .skill-assessment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--secondary-color);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .skill-name-form {
            color: var(--text-color);
            font-size: 14px;
            flex: 1;
        }

        .star-rating-input {
            display: flex;
            gap: 3px;
        }

        .star-input {
            font-size: 18px;
            color: var(--border-color);
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .star-input.active,
        .star-input:hover {
            color: #FFD700;
        }

        .grade-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .grade-option {
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            background: var(--bg-darker);
        }

        .grade-option.selected {
            border-color: var(--accent-color);
            background: rgba(233, 69, 96, 0.1);
            color: var(--accent-color);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .btn-save {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-save:hover {
            background: #00b76a;
            transform: translateY(-1px);
        }

        .btn-cancel {
            background: var(--border-color);
            color: var(--text-secondary);
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-cancel:hover {
            background: var(--text-secondary);
            color: var(--secondary-color);
        }
    </style>
    
    <!-- Enhanced Database System with Report Cards -->
    <script>
        // Simple Local Database System (same as other pages)
        class LocalDatabase {
            constructor() {
                this.storage = localStorage;
                this.initialized = true;
                this.initializeAcademicCollections();
            }

            // Save data to localStorage
            save(collection, id, data) {
                try {
                    const key = `db_${collection}`;
                    const existing = this.getCollection(collection);
                    
                    // Add metadata
                    data.id = id;
                    data.createdAt = existing[id]?.createdAt || new Date().toISOString();
                    data.updatedAt = new Date().toISOString();
                    
                    existing[id] = data;
                    this.storage.setItem(key, JSON.stringify(existing));
                    
                    console.log(`‚úÖ Saved to ${collection}:`, id);
                    return { success: true, id: id };
                } catch (error) {
                    console.error(`‚ùå Save failed:`, error);
                    return { success: false, error: error.message };
                }
            }

            // Get all data from a collection
            getCollection(collection) {
                try {
                    const key = `db_${collection}`;
                    const data = this.storage.getItem(key);
                    return data ? JSON.parse(data) : {};
                } catch (error) {
                    console.error(`‚ùå Get collection failed:`, error);
                    return {};
                }
            }

            // Get specific record
            get(collection, id) {
                const data = this.getCollection(collection);
                return data[id] || null;
            }

            // Delete record
            delete(collection, id) {
                try {
                    const data = this.getCollection(collection);
                    if (data[id]) {
                        delete data[id];
                        this.storage.setItem(`db_${collection}`, JSON.stringify(data));
                        return { success: true };
                    }
                    return { success: false, error: 'Record not found' };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            // Count records in collection
            count(collection) {
                return Object.keys(this.getCollection(collection)).length;
            }

            // Initialize academic collections
            initializeAcademicCollections() {
                const collections = ['academic_records', 'subjects', 'assessments'];
                collections.forEach(collection => {
                    if (!this.storage.getItem(`db_${collection}`)) {
                        this.storage.setItem(`db_${collection}`, JSON.stringify({}));
                        console.log(`üìö ${collection} collection initialized`);
                    }
                });
                this.setupDefaultSubjects();
            }

            // Setup default preschool subjects
            setupDefaultSubjects() {
                const subjects = this.getCollection('subjects');
                if (Object.keys(subjects).length === 0) {
                    const defaultSubjects = {
                        'literacy': {
                            id: 'literacy',
                            name: 'Literacy & Language',
                            description: 'Reading, writing, and communication skills',
                            skills: [
                                'Letter Recognition',
                                'Phonics Awareness',
                                'Vocabulary Development',
                                'Listening Skills',
                                'Speaking Confidence'
                            ],
                            color: '#4CAF50'
                        },
                        'numeracy': {
                            id: 'numeracy',
                            name: 'Numeracy & Math',
                            description: 'Number concepts and mathematical thinking',
                            skills: [
                                'Number Recognition (1-20)',
                                'Counting Skills',
                                'Shape Recognition',
                                'Pattern Identification',
                                'Basic Addition/Subtraction'
                            ],
                            color: '#2196F3'
                        },
                        'science': {
                            id: 'science',
                            name: 'Science Discovery',
                            description: 'Exploration and scientific thinking',
                            skills: [
                                'Observation Skills',
                                'Nature Awareness',
                                'Simple Experiments',
                                'Weather Understanding',
                                'Living vs Non-living'
                            ],
                            color: '#FF9800'
                        },
                        'creative': {
                            id: 'creative',
                            name: 'Creative Arts',
                            description: 'Artistic expression and creativity',
                            skills: [
                                'Drawing & Coloring',
                                'Music & Rhythm',
                                'Craft Activities',
                                'Imaginative Play',
                                'Color Recognition'
                            ],
                            color: '#9C27B0'
                        },
                        'physical': {
                            id: 'physical',
                            name: 'Physical Development',
                            description: 'Motor skills and physical coordination',
                            skills: [
                                'Gross Motor Skills',
                                'Fine Motor Skills',
                                'Balance & Coordination',
                                'Following Instructions',
                                'Team Participation'
                            ],
                            color: '#FF5722'
                        },
                        'social': {
                            id: 'social',
                            name: 'Social & Emotional',
                            description: 'Social interaction and emotional development',
                            skills: [
                                'Sharing & Cooperation',
                                'Following Classroom Rules',
                                'Emotional Expression',
                                'Friendship Building',
                                'Conflict Resolution'
                            ],
                            color: '#795548'
                        }
                    };
                    
                    this.storage.setItem('db_subjects', JSON.stringify(defaultSubjects));
                    console.log('üìñ Default subjects created');
                }
            }

            // Create academic record for student
            createAcademicRecord(studentId, term = 'Term 1', academicYear = '2024-2025') {
                const subjects = this.getCollection('subjects');
                const recordId = `${studentId}_${term.replace(' ', '')}_${academicYear.replace('-', '')}`;
                
                const academicRecord = {
                    id: recordId,
                    studentId: studentId,
                    term: term,
                    academicYear: academicYear,
                    subjects: {},
                    overallGrade: 'Developing',
                    teacherComments: '',
                    attendance: {
                        daysPresent: 0,
                        totalDays: 0,
                        percentage: 0
                    },
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                // Initialize each subject with default ratings
                Object.keys(subjects).forEach(subjectId => {
                    const subject = subjects[subjectId];
                    academicRecord.subjects[subjectId] = {
                        name: subject.name,
                        grade: 'Developing',
                        skills: {},
                        teacherNotes: ''
                    };

                    // Initialize skills with default ratings (1-5 stars)
                    subject.skills.forEach(skill => {
                        academicRecord.subjects[subjectId].skills[skill] = 3; // Default 3 stars
                    });
                });

                return this.save('academic_records', recordId, academicRecord);
            }

            // Update academic record
            updateAcademicRecord(recordId, updates) {
                const records = this.getCollection('academic_records');
                if (records[recordId]) {
                    const record = { ...records[recordId], ...updates };
                    record.updatedAt = new Date().toISOString();
                    return this.save('academic_records', recordId, record);
                }
                return { success: false, error: 'Record not found' };
            }

            // Get student's academic records
            getStudentRecords(studentId) {
                const records = this.getCollection('academic_records');
                return Object.values(records).filter(record => record.studentId === studentId);
            }

            // Generate sample academic records
            generateSampleAcademicRecords() {
                const students = this.getCollection('students');
                const studentIds = Object.keys(students);
                let created = 0;

                studentIds.forEach(studentId => {
                    const existingRecords = this.getStudentRecords(studentId);
                    if (existingRecords.length === 0) {
                        // Create record for current term
                        const result = this.createAcademicRecord(studentId, 'Term 1', '2024-2025');
                        if (result.success) {
                            // Add some sample data
                            this.populateSampleData(result.id);
                            created++;
                        }
                    }
                });

                return { success: true, created: created };
            }

            // Populate with realistic sample data
            populateSampleData(recordId) {
                const records = this.getCollection('academic_records');
                const record = records[recordId];
                if (!record) return;

                // Sample grades and skills
                const gradeOptions = ['Excellent', 'Good', 'Satisfactory', 'Developing'];
                const comments = [
                    'Shows excellent progress and enthusiasm for learning.',
                    'Demonstrates good understanding of concepts with consistent effort.',
                    'Making steady progress with encouragement and support.',
                    'Developing foundational skills, needs continued practice.',
                    'Active participant in class activities with positive attitude.',
                    'Shows creativity and imagination in assignments.'
                ];

                Object.keys(record.subjects).forEach(subjectId => {
                    // Assign random but realistic grades
                    const grade = gradeOptions[Math.floor(Math.random() * gradeOptions.length)];
                    record.subjects[subjectId].grade = grade;

                    // Assign random skill ratings (2-5 stars based on grade)
                    const baseRating = grade === 'Excellent' ? 4 : 
                                     grade === 'Good' ? 3 : 
                                     grade === 'Satisfactory' ? 2 : 1;
                    
                    Object.keys(record.subjects[subjectId].skills).forEach(skill => {
                        record.subjects[subjectId].skills[skill] = Math.min(5, baseRating + Math.floor(Math.random() * 2));
                    });

                    // Add subject-specific notes
                    record.subjects[subjectId].teacherNotes = comments[Math.floor(Math.random() * comments.length)];
                });

                // Set overall grade based on average
                const grades = Object.values(record.subjects).map(s => s.grade);
                const excellentCount = grades.filter(g => g === 'Excellent').length;
                const goodCount = grades.filter(g => g === 'Good').length;
                
                if (excellentCount >= grades.length / 2) {
                    record.overallGrade = 'Excellent';
                } else if (goodCount >= grades.length / 2) {
                    record.overallGrade = 'Good';
                } else if (excellentCount + goodCount >= grades.length / 2) {
                    record.overallGrade = 'Satisfactory';
                } else {
                    record.overallGrade = 'Developing';
                }

                // Set teacher comments
                record.teacherComments = comments[Math.floor(Math.random() * comments.length)];

                // Set attendance
                record.attendance = {
                    daysPresent: Math.floor(Math.random() * 20) + 75, // 75-95 days
                    totalDays: 95,
                    percentage: 0
                };
                record.attendance.percentage = Math.round((record.attendance.daysPresent / record.attendance.totalDays) * 100);

                this.storage.setItem('db_academic_records', JSON.stringify(records));
            }
        }
        // Using shared database system
        console.log('üóÑÔ∏è Student Reports using shared database system');
    </script>
</head>
<body>
    <div class="dashboard-container">
        <!-- ******* ENHANCED MODERN SIDEBAR ******* -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class='bx bxs-crown'></i>
                    </div>
                    <div class="logo-text">
                        <span class="logo-title">Super Admin</span>
                        <span class="logo-subtitle">Management Portal</span>
                    </div>
                </div>
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class='bx bx-menu'></i>
                </button>
            </div>
            
            <div class="sidebar-profile">
                <div class="profile-avatar">
                    <i class='bx bxs-user-circle'></i>
                </div>
                <div class="profile-info">
                    <span class="profile-name">Administrator</span>
                    <span class="profile-role">System Admin</span>
                </div>
                <div class="profile-status">
                    <div class="status-indicator online"></div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <span class="nav-section-title">Main Navigation</span>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="dashboard.html" class="nav-link">
                                <div class="nav-icon">
                                    <i class='bx bxs-dashboard'></i>
                                </div>
                                <span class="nav-text">Overview</span>
                                <div class="nav-indicator"></div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="user-registration.html" class="nav-link">
                                <div class="nav-icon">
                                    <i class='bx bx-user-plus'></i>
                                </div>
                                <span class="nav-text">User Registration</span>
                                <div class="nav-indicator"></div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="user-directory.html" class="nav-link">
                                <div class="nav-icon">
                                    <i class='bx bx-group'></i>
                                </div>
                                <span class="nav-text">User Directory</span>
                                <div class="nav-indicator"></div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="school-applications.html" class="nav-link">
                                <div class="nav-icon">
                                    <i class='bx bx-file-blank'></i>
                                </div>
                                <span class="nav-text">School Applications</span>
                                <div class="nav-badge pending-count">0</div>
                                <div class="nav-indicator"></div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="student-reports.html" class="nav-link active">
                                <div class="nav-icon">
                                    <i class='bx bxs-report'></i>
                                </div>
                                <span class="nav-text">Student Reports</span>
                                <div class="nav-indicator"></div>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <span class="nav-section-title">System Management</span>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="system-logs.html" class="nav-link">
                                <div class="nav-icon">
                                    <i class='bx bxs-file-doc'></i>
                                </div>
                                <span class="nav-text">System Logs</span>
                                <div class="nav-indicator"></div>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <span class="nav-section-title">Quick Actions</span>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="../index.html" class="nav-link logout-link">
                                <div class="nav-icon">
                                    <i class='bx bx-home'></i>
                                </div>
                                <span class="nav-text">Back to Home</span>
                                <div class="nav-indicator"></div>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="system-status">
                    <div class="status-item">
                        <i class='bx bx-wifi'></i>
                        <span>Online</span>
                    </div>
                    <div class="status-item">
                        <i class='bx bx-time'></i>
                        <span id="currentTime">--:--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header">
                <h1>üìä Student Report Cards</h1>
                <div class="user-info">
                    <span>Welcome, Super Admin</span>
                    <i class='bx bxs-user-circle'></i>
                </div>
            </div>

            <div class="content-section">
                <div class="section-header">
                    <h2>üéì Academic Progress Reports</h2>
                    <div class="section-actions">
                        <button class="btn-primary" onclick="openAssessmentForm()"><i class='bx bx-edit'></i> Add/Edit Assessment</button>
                        <button class="btn-secondary" onclick="generateSampleReports()"><i class='bx bx-plus'></i> Generate Sample Data (Demo)</button>
                        <button class="btn-secondary" onclick="exportAllReports()"><i class='bx bx-download'></i> Export All Reports</button>
                        <button class="btn-secondary" onclick="refreshReports()"><i class='bx bx-refresh'></i> Refresh</button>
                    </div>
                </div>

                <!-- Student Search & Filters -->
                <div class="student-search">
                    <div class="search-group">
                        <label for="studentSelect">Select Student</label>
                        <select id="studentSelect" onchange="loadStudentReport()">
                            <option value="">Choose a student...</option>
                        </select>
                    </div>
                    <div class="search-group">
                        <label for="classFilter">Filter by Class</label>
                        <select id="classFilter" onchange="filterByClass()">
                            <option value="">All Classes</option>
                            <option value="Grade 1A">Grade 1A</option>
                            <option value="Grade 1B">Grade 1B</option>
                            <option value="Grade 1C">Grade 1C</option>
                            <option value="Grade 2A">Grade 2A</option>
                            <option value="Grade 2B">Grade 2B</option>
                            <option value="Grade 2C">Grade 2C</option>
                            <option value="Grade 3A">Grade 3A</option>
                            <option value="Grade 3B">Grade 3B</option>
                            <option value="Grade 3C">Grade 3C</option>
                        </select>
                    </div>
                    <div class="search-group">
                        <label for="searchName">Search by Name</label>
                        <input type="text" id="searchName" placeholder="Type student name..." oninput="filterStudents()">
                    </div>
                </div>

                <!-- Term Selector -->
                <div class="term-selector">
                    <h4 style="margin: 0 0 10px 0; color: var(--text-color); font-size: 14px;">Academic Term</h4>
                    <div class="term-buttons">
                        <button class="term-btn active" data-term="Term 1" onclick="selectTerm(this)">Term 1</button>
                        <button class="term-btn" data-term="Term 2" onclick="selectTerm(this)">Term 2</button>
                        <button class="term-btn" data-term="Term 3" onclick="selectTerm(this)">Term 3</button>
                    </div>
                </div>

                <!-- Student Reports Container -->
                <div id="reportsContainer">
                    <div class="no-students">
                        <i class='bx bx-file-blank'></i>
                        <h3>No Student Selected</h3>
                        <p>Please select a student from the dropdown above to view their report card.</p>
                        <p style="margin-top: 15px; color: var(--text-secondary); font-size: 14px;">
                            <strong>Note:</strong> Reports are generated based on teacher assessments. 
                            Use "Add/Edit Assessment" to input academic data for students.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Assessment Form Modal -->
    <div id="assessmentModal" class="assessment-modal">
        <div class="assessment-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Student Assessment Form</h3>
                <button class="modal-close" onclick="closeAssessmentModal()">&times;</button>
            </div>
            
            <form class="assessment-form" id="assessmentForm">
                <!-- Student Selection -->
                <div class="form-section">
                    <h4>Student Information</h4>
                    <div class="form-group">
                        <label for="assessmentStudent">Select Student</label>
                        <select id="assessmentStudent" required onchange="loadStudentForAssessment()">
                            <option value="">Choose a student...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assessmentTerm">Academic Term</label>
                        <select id="assessmentTerm" required>
                            <option value="Term 1">Term 1</option>
                            <option value="Term 2">Term 2</option>
                            <option value="Term 3">Term 3</option>
                        </select>
                    </div>
                </div>

                <!-- Attendance Section -->
                <div class="form-section">
                    <h4>Attendance</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label for="daysPresent">Days Present</label>
                            <input type="number" id="daysPresent" min="0" max="100" required onchange="calculateAttendance()">
                        </div>
                        <div class="form-group">
                            <label for="totalDays">Total School Days</label>
                            <input type="number" id="totalDays" min="1" max="100" value="95" required onchange="calculateAttendance()">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Attendance Percentage</label>
                        <input type="text" id="attendancePercentage" readonly style="background: var(--bg-darker); color: var(--accent-color); font-weight: bold;">
                    </div>
                </div>

                <!-- Subjects Assessment -->
                <div id="subjectsAssessment">
                    <!-- Dynamic subjects will be loaded here -->
                </div>

                <!-- General Comments -->
                <div class="form-section">
                    <h4>General Teacher Comments</h4>
                    <div class="form-group">
                        <label for="generalComments">Overall Performance Comments</label>
                        <textarea id="generalComments" rows="4" placeholder="Enter general comments about the student's overall progress and development..."></textarea>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeAssessmentModal()">Cancel</button>
                    <button type="submit" class="btn-save">Save Assessment</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentTerm = 'Term 1';
        let allStudents = [];

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeSidebar();
            updateTime();
            updatePendingCount();
            loadStudents();
            
            // Update time every minute
            setInterval(updateTime, 60000);
            
            // Update pending count every 5 minutes
            setInterval(updatePendingCount, 300000);
        });

        // Load all students into dropdown
        function loadStudents() {
            const students = schoolDB ? schoolDB.getStudents() : [];
            allStudents = students;
            populateStudentDropdown(allStudents);
        }

        // Populate student dropdown
        function populateStudentDropdown(students) {
            const select = document.getElementById('studentSelect');
            select.innerHTML = '<option value="">Choose a student...</option>';
            
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.firstName} ${student.lastName} (${student.class})`;
                select.appendChild(option);
            });
        }

        // Filter students by class
        function filterByClass() {
            const classFilter = document.getElementById('classFilter').value;
            const searchName = document.getElementById('searchName').value.toLowerCase();
            
            let filtered = allStudents;
            
            if (classFilter) {
                filtered = filtered.filter(student => student.class === classFilter);
            }
            
            if (searchName) {
                filtered = filtered.filter(student => 
                    `${student.firstName} ${student.lastName}`.toLowerCase().includes(searchName)
                );
            }
            
            populateStudentDropdown(filtered);
        }

        // Filter students by name
        function filterStudents() {
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const classFilter = document.getElementById('classFilter').value;
            
            let filtered = allStudents;
            
            if (classFilter) {
                filtered = filtered.filter(student => student.class === classFilter);
            }
            
            if (searchName) {
                filtered = filtered.filter(student => 
                    `${student.firstName} ${student.lastName}`.toLowerCase().includes(searchName)
                );
            }
            
            populateStudentDropdown(filtered);
        }

        // Select term
        function selectTerm(button) {
            document.querySelectorAll('.term-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            currentTerm = button.dataset.term;
            
            // Reload current student report if one is selected
            const selectedStudentId = document.getElementById('studentSelect').value;
            if (selectedStudentId) {
                loadStudentReport();
            }
        }

        // Load student report
        function loadStudentReport() {
            const studentId = document.getElementById('studentSelect').value;
            if (!studentId) {
                showNoStudentSelected();
                return;
            }

            const students = schoolDB ? schoolDB.getStudents() : [];
            const student = students.find(s => s.studentId === studentId);
            if (!student) {
                showNoStudentSelected();
                return;
            }

            // Get academic records for the student
            const records = window.db.getStudentRecords(studentId);
            const currentRecord = records.find(r => r.term === currentTerm);

            if (!currentRecord) {
                showNoReportAvailable(student);
                return;
            }

            displayStudentReport(student, currentRecord);
        }

        // Show no student selected message
        function showNoStudentSelected() {
            document.getElementById('reportsContainer').innerHTML = `
                <div class="no-students">
                    <i class='bx bx-file-blank'></i>
                    <h3>No Student Selected</h3>
                    <p>Please select a student from the dropdown above to view their report card.</p>
                </div>
            `;
        }

        // Show no report available message
        function showNoReportAvailable(student) {
            document.getElementById('reportsContainer').innerHTML = `
                <div class="no-students">
                    <i class='bx bx-error-circle'></i>
                    <h3>No Report Available</h3>
                    <p>No academic record found for ${student.firstName} ${student.lastName} in ${currentTerm}.</p>
                    <p style="margin-top: 15px; color: var(--text-secondary); font-size: 14px;">
                        Teachers need to input assessment data to generate reports.
                    </p>
                    <button class="btn-primary" onclick="openAssessmentFormForStudent('${student.id}')">
                        <i class='bx bx-edit'></i> Add Assessment Data
                    </button>
                </div>
            `;
        }

        // Display student report
        function displayStudentReport(student, record) {
            const subjects = window.db.getCollection('subjects');
            const container = document.getElementById('reportsContainer');

            let subjectsHtml = '';
            Object.keys(record.subjects).forEach(subjectId => {
                const subjectData = record.subjects[subjectId];
                const subjectInfo = subjects[subjectId];
                
                let skillsHtml = '';
                Object.entries(subjectData.skills).forEach(([skill, rating]) => {
                    const stars = generateStarRating(rating);
                    skillsHtml += `
                        <li class="skill-item">
                            <span class="skill-name">${skill}</span>
                            <div class="skill-rating">${stars}</div>
                        </li>
                    `;
                });

                const gradeClass = getGradeClass(subjectData.grade);
                subjectsHtml += `
                    <div class="subject-card">
                        <div class="subject-header">
                            <div>
                                <div class="subject-name">${subjectData.name}</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 2px;">
                                    ${subjectInfo ? subjectInfo.description : ''}
                                </div>
                            </div>
                            <div class="grade-circle ${gradeClass}">
                                ${getGradeAbbreviation(subjectData.grade)}
                            </div>
                        </div>
                        <ul class="skills-list">
                            ${skillsHtml}
                        </ul>
                        ${subjectData.teacherNotes ? `
                            <div class="teacher-comments">
                                <div class="comment-header">Teacher Notes</div>
                                <div class="comment-text">${subjectData.teacherNotes}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            container.innerHTML = `
                <div class="student-card">
                    <div class="student-header">
                        <div class="student-info">
                            <h3>${student.firstName} ${student.lastName}</h3>
                            <div class="student-details">
                                Class: ${student.class.toUpperCase()} | Age: ${student.age} years | 
                                Student ID: ${student.studentId} | Term: ${record.term}
                            </div>
                        </div>
                        <div class="student-actions">
                            <button class="print-button" onclick="printReport('${student.id}')">
                                <i class='bx bx-printer'></i> Print Report
                            </button>
                        </div>
                    </div>

                    <div class="report-grid">
                        ${subjectsHtml}
                    </div>

                    <div class="overall-summary">
                        <h4 style="margin: 0 0 15px 0; color: var(--text-color);">Overall Performance Summary</h4>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="summary-value">${record.overallGrade}</div>
                                <div class="summary-label">Overall Grade</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${record.attendance.percentage}%</div>
                                <div class="summary-label">Attendance</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${record.attendance.daysPresent}/${record.attendance.totalDays}</div>
                                <div class="summary-label">Days Present</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${Object.keys(record.subjects).length}</div>
                                <div class="summary-label">Subjects</div>
                            </div>
                        </div>
                        
                        ${record.teacherComments ? `
                            <div class="teacher-comments">
                                <div class="comment-header">General Teacher Comments</div>
                                <div class="comment-text">${record.teacherComments}</div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Generate star rating HTML
        function generateStarRating(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<i class="bx bxs-star star"></i>';
                } else {
                    stars += '<i class="bx bxs-star star empty"></i>';
                }
            }
            return stars;
        }

        // Get grade CSS class
        function getGradeClass(grade) {
            switch(grade.toLowerCase()) {
                case 'excellent': return 'grade-a';
                case 'good': return 'grade-b';
                case 'satisfactory': return 'grade-c';
                case 'needs improvement': return 'grade-d';
                default: return 'grade-developing';
            }
        }

        // Get grade abbreviation
        function getGradeAbbreviation(grade) {
            switch(grade.toLowerCase()) {
                case 'excellent': return 'E';
                case 'good': return 'G';
                case 'satisfactory': return 'S';
                case 'needs improvement': return 'NI';
                default: return 'D';
            }
        }

        // Create new student report
        function createStudentReport(studentId) {
            const result = window.db.createAcademicRecord(studentId, currentTerm, '2024-2025');
            if (result.success) {
                window.db.populateSampleData(result.id);
                alert('‚úÖ Academic report created successfully!');
                loadStudentReport();
            } else {
                alert('‚ùå Failed to create report: ' + result.error);
            }
        }

        // Generate sample reports for all students
        function generateSampleReports() {
            if (confirm('Generate sample academic reports for all students?\n\nThis will create report cards with sample data for students who don\'t have reports yet.')) {
                const result = window.db.generateSampleAcademicRecords();
                if (result.success) {
                    alert(`‚úÖ Generated ${result.created} sample academic reports!`);
                    loadStudents(); // Refresh the dropdown
                } else {
                    alert('‚ùå Failed to generate sample reports.');
                }
            }
        }

        // Print report
        function printReport(studentId) {
            const students = window.db.getCollection('students');
            const student = students[studentId];
            const records = window.db.getStudentRecords(studentId);
            const currentRecord = records.find(r => r.term === currentTerm);
            
            if (!student || !currentRecord) {
                alert('‚ùå Cannot print report: Student or report data not found.');
                return;
            }

            // Create print-friendly version
            const printContent = generatePrintableReport(student, currentRecord);
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        // Generate printable report HTML
        function generatePrintableReport(student, record) {
            const subjects = window.db.getCollection('subjects');
            let subjectsHtml = '';
            
            Object.keys(record.subjects).forEach(subjectId => {
                const subjectData = record.subjects[subjectId];
                let skillsHtml = '';
                
                Object.entries(subjectData.skills).forEach(([skill, rating]) => {
                    skillsHtml += `
                        <tr>
                            <td style="padding: 5px; border: 1px solid #ddd;">${skill}</td>
                            <td style="padding: 5px; border: 1px solid #ddd; text-align: center;">${'‚òÖ'.repeat(rating)}${'‚òÜ'.repeat(5-rating)}</td>
                        </tr>
                    `;
                });

                subjectsHtml += `
                    <div style="page-break-inside: avoid; margin-bottom: 20px;">
                        <h3 style="color: #333; border-bottom: 2px solid #4CAF50; padding-bottom: 5px;">
                            ${subjectData.name} - Grade: ${subjectData.grade}
                        </h3>
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px;">
                            <thead>
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Skill</th>
                                    <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">Rating</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${skillsHtml}
                            </tbody>
                        </table>
                        ${subjectData.teacherNotes ? `<p><strong>Teacher Notes:</strong> ${subjectData.teacherNotes}</p>` : ''}
                    </div>
                `;
            });

            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Report Card - ${student.firstName} ${student.lastName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
                        .header { text-align: center; border-bottom: 3px solid #4CAF50; padding-bottom: 20px; margin-bottom: 30px; }
                        .school-name { font-size: 24px; font-weight: bold; color: #2196F3; margin-bottom: 5px; }
                        .report-title { font-size: 18px; color: #666; }
                        .student-info { background: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
                        .summary { background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0; }
                        .footer { margin-top: 30px; padding-top: 20px; border-top: 2px solid #ddd; text-align: center; color: #666; font-size: 12px; }
                        @media print { .no-print { display: none; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="school-name">üè´ Tresor Secondary School</div>
                        <div class="report-title">Student Academic Report Card</div>
                    </div>
                    
                    <div class="student-info">
                        <div class="info-grid">
                            <div><strong>Student Name:</strong> ${student.firstName} ${student.lastName}</div>
                            <div><strong>Student ID:</strong> ${student.studentId}</div>
                            <div><strong>Class:</strong> ${student.class.toUpperCase()}</div>
                            <div><strong>Age:</strong> ${student.age} years</div>
                            <div><strong>Term:</strong> ${record.term}</div>
                            <div><strong>Academic Year:</strong> ${record.academicYear}</div>
                        </div>
                    </div>

                    <div class="summary">
                        <h3 style="margin-top: 0; color: #2196F3;">Performance Summary</h3>
                        <div class="info-grid">
                            <div><strong>Overall Grade:</strong> ${record.overallGrade}</div>
                            <div><strong>Attendance:</strong> ${record.attendance.percentage}% (${record.attendance.daysPresent}/${record.attendance.totalDays} days)</div>
                        </div>
                        ${record.teacherComments ? `<p><strong>General Comments:</strong> ${record.teacherComments}</p>` : ''}
                    </div>

                    ${subjectsHtml}

                    <div class="footer">
                        <p>Report generated on ${new Date().toLocaleDateString()} | Tresor Secondary School Management System</p>
                        <p>Rating Scale: ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ Excellent | ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ Good | ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ Satisfactory | ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ Needs Improvement | ‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ Developing</p>
                    </div>
                </body>
                </html>
            `;
        }

        // Export all reports
        function exportAllReports() {
            alert('üìä Export functionality will be implemented to generate PDF reports for all students.');
        }

        // Refresh reports
        function refreshReports() {
            loadStudents();
            loadStudentReport();
            alert('üîÑ Student reports refreshed successfully!');
        }

        // ===== ASSESSMENT FORM FUNCTIONS =====

        // Open assessment form modal
        function openAssessmentForm() {
            const modal = document.getElementById('assessmentModal');
            modal.style.display = 'flex';
            loadStudentsForAssessment();
            loadSubjectsForAssessment();
        }

        // Open assessment form for specific student
        function openAssessmentFormForStudent(studentId) {
            openAssessmentForm();
            document.getElementById('assessmentStudent').value = studentId;
            document.getElementById('assessmentTerm').value = currentTerm;
            loadStudentForAssessment();
        }

        // Close assessment form modal
        function closeAssessmentModal() {
            const modal = document.getElementById('assessmentModal');
            modal.style.display = 'none';
            document.getElementById('assessmentForm').reset();
        }

        // Load students for assessment dropdown
        function loadStudentsForAssessment() {
            const select = document.getElementById('assessmentStudent');
            select.innerHTML = '<option value="">Choose a student...</option>';
            
            allStudents.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.firstName} ${student.lastName} (${student.class})`;
                select.appendChild(option);
            });
        }

        // Load student data for assessment
        function loadStudentForAssessment() {
            const studentId = document.getElementById('assessmentStudent').value;
            const term = document.getElementById('assessmentTerm').value;
            
            if (!studentId || !term) return;

            // Check if existing record exists
            const records = window.db.getStudentRecords(studentId);
            const existingRecord = records.find(r => r.term === term);
            
            if (existingRecord) {
                populateAssessmentForm(existingRecord);
            } else {
                // Create new record template
                const result = window.db.createAcademicRecord(studentId, term, '2024-2025');
                if (result.success) {
                    const newRecord = window.db.getCollection('academic_records')[result.id];
                    populateAssessmentForm(newRecord);
                }
            }
        }

        // Populate assessment form with existing data
        function populateAssessmentForm(record) {
            // Set attendance data
            document.getElementById('daysPresent').value = record.attendance.daysPresent || 0;
            document.getElementById('totalDays').value = record.attendance.totalDays || 95;
            calculateAttendance();

            // Set general comments
            document.getElementById('generalComments').value = record.teacherComments || '';

            // Load subjects with current data
            loadSubjectsForAssessment(record);
        }

        // Load subjects for assessment
        function loadSubjectsForAssessment(existingRecord = null) {
            const subjects = window.db.getCollection('subjects');
            const container = document.getElementById('subjectsAssessment');
            
            let subjectsHtml = '';
            Object.keys(subjects).forEach(subjectId => {
                const subject = subjects[subjectId];
                const existingSubject = existingRecord?.subjects[subjectId];
                
                let skillsHtml = '';
                subject.skills.forEach(skill => {
                    const currentRating = existingSubject?.skills[skill] || 0;
                    skillsHtml += `
                        <div class="skill-assessment-item">
                            <span class="skill-name-form">${skill}</span>
                            <div class="star-rating-input" data-skill="${skill}" data-subject="${subjectId}">
                                ${[1,2,3,4,5].map(rating => 
                                    `<i class="bx bxs-star star-input ${rating <= currentRating ? 'active' : ''}" 
                                       data-rating="${rating}" onclick="setSkillRating('${subjectId}', '${skill}', ${rating})"></i>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                });

                const currentGrade = existingSubject?.grade || 'Developing';
                const gradeOptions = ['Excellent', 'Good', 'Satisfactory', 'Developing'];
                
                subjectsHtml += `
                    <div class="form-section">
                        <h4>${subject.name}</h4>
                        
                        <!-- Grade Selection -->
                        <div class="form-group">
                            <label>Overall Grade</label>
                            <div class="grade-selector" data-subject="${subjectId}">
                                ${gradeOptions.map(grade => 
                                    `<div class="grade-option ${grade === currentGrade ? 'selected' : ''}" 
                                          onclick="setSubjectGrade('${subjectId}', '${grade}')">${grade}</div>`
                                ).join('')}
                            </div>
                        </div>

                        <!-- Skills Assessment -->
                        <div class="form-group">
                            <label>Individual Skills (1-5 stars)</label>
                            <div class="skills-assessment">
                                ${skillsHtml}
                            </div>
                        </div>

                        <!-- Subject Notes -->
                        <div class="form-group">
                            <label for="notes_${subjectId}">Teacher Notes</label>
                            <textarea id="notes_${subjectId}" rows="3" placeholder="Enter specific notes for ${subject.name}...">${existingSubject?.teacherNotes || ''}</textarea>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = subjectsHtml;
        }

        // Set skill rating
        function setSkillRating(subjectId, skill, rating) {
            const ratingContainer = document.querySelector(`[data-skill="${skill}"][data-subject="${subjectId}"]`);
            const stars = ratingContainer.querySelectorAll('.star-input');
            
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // Set subject grade
        function setSubjectGrade(subjectId, grade) {
            const gradeSelector = document.querySelector(`[data-subject="${subjectId}"] .grade-selector`);
            const options = gradeSelector.querySelectorAll('.grade-option');
            
            options.forEach(option => {
                option.classList.remove('selected');
                if (option.textContent === grade) {
                    option.classList.add('selected');
                }
            });
        }

        // Calculate attendance percentage
        function calculateAttendance() {
            const present = parseInt(document.getElementById('daysPresent').value) || 0;
            const total = parseInt(document.getElementById('totalDays').value) || 1;
            const percentage = Math.round((present / total) * 100);
            document.getElementById('attendancePercentage').value = `${percentage}%`;
        }

        // Handle assessment form submission
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('assessmentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveAssessmentData();
            });

            // Add event listeners for attendance calculation
            document.getElementById('daysPresent').addEventListener('input', calculateAttendance);
            document.getElementById('totalDays').addEventListener('input', calculateAttendance);
        });

        // Save assessment data
        function saveAssessmentData() {
            const studentId = document.getElementById('assessmentStudent').value;
            const term = document.getElementById('assessmentTerm').value;
            
            if (!studentId || !term) {
                alert('‚ùå Please select a student and term.');
                return;
            }

            const recordId = `${studentId}_${term.replace(' ', '')}_2024-2025`;
            const subjects = window.db.getCollection('subjects');
            
            // Collect assessment data
            const assessmentData = {
                studentId: studentId,
                term: term,
                academicYear: '2024-2025',
                subjects: {},
                attendance: {
                    daysPresent: parseInt(document.getElementById('daysPresent').value) || 0,
                    totalDays: parseInt(document.getElementById('totalDays').value) || 95,
                    percentage: 0
                },
                teacherComments: document.getElementById('generalComments').value || '',
                overallGrade: 'Developing'
            };

            // Calculate attendance percentage
            assessmentData.attendance.percentage = Math.round(
                (assessmentData.attendance.daysPresent / assessmentData.attendance.totalDays) * 100
            );

            // Collect subject data
            Object.keys(subjects).forEach(subjectId => {
                const subject = subjects[subjectId];
                
                // Get selected grade
                const selectedGrade = document.querySelector(`[data-subject="${subjectId}"] .grade-option.selected`);
                const grade = selectedGrade ? selectedGrade.textContent : 'Developing';
                
                // Get skills ratings
                const skills = {};
                subject.skills.forEach(skill => {
                    const ratingContainer = document.querySelector(`[data-skill="${skill}"][data-subject="${subjectId}"]`);
                    const activeStars = ratingContainer.querySelectorAll('.star-input.active');
                    skills[skill] = activeStars.length;
                });
                
                // Get teacher notes
                const notes = document.getElementById(`notes_${subjectId}`).value || '';
                
                assessmentData.subjects[subjectId] = {
                    name: subject.name,
                    grade: grade,
                    skills: skills,
                    teacherNotes: notes
                };
            });

            // Calculate overall grade based on subject grades
            const grades = Object.values(assessmentData.subjects).map(s => s.grade);
            const excellentCount = grades.filter(g => g === 'Excellent').length;
            const goodCount = grades.filter(g => g === 'Good').length;
            
            if (excellentCount >= grades.length / 2) {
                assessmentData.overallGrade = 'Excellent';
            } else if (goodCount >= grades.length / 2) {
                assessmentData.overallGrade = 'Good';
            } else if (excellentCount + goodCount >= grades.length / 2) {
                assessmentData.overallGrade = 'Satisfactory';
            } else {
                assessmentData.overallGrade = 'Developing';
            }

            // Save to database
            const result = window.db.save('academic_records', recordId, assessmentData);
            
            if (result.success) {
                alert('‚úÖ Assessment data saved successfully!');
                closeAssessmentModal();
                
                // Refresh the report if the same student is selected
                const currentSelectedStudent = document.getElementById('studentSelect').value;
                if (currentSelectedStudent === studentId) {
                    loadStudentReport();
                }
            } else {
                alert('‚ùå Failed to save assessment data: ' + result.error);
            }
        }

        // Enhanced Sidebar functionality
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const isCollapsed = sidebar.classList.toggle('collapsed');
            
            // Save state in localStorage
            localStorage.setItem('sidebarCollapsed', isCollapsed);
        }

        // Initialize sidebar state from localStorage
        function initializeSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            
            if (isCollapsed) {
                sidebar.classList.add('collapsed');
            }
        }

        // Update current time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit'
            });
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        // Update pending applications count
        function updatePendingCount() {
            const pendingCountElement = document.querySelector('.pending-count');
            if (pendingCountElement) {
                // Get actual pending applications count
                const applications = window.db ? window.db.getCollection('applications') : {};
                const pendingCount = Object.values(applications).filter(app => app.status === 'pending').length;
                pendingCountElement.textContent = pendingCount;
                pendingCountElement.style.display = pendingCount > 0 ? 'block' : 'none';
            }
        }
    </script>
</body>
</html>