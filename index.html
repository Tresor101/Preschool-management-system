<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- ******* CSS ******* -->
    <link rel="stylesheet" href="style.css" />
    <!-- ******* ICONS ******* -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"/>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" 
    integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    
    <!-- ******* DATABASE ******* -->
    <script src="database.js"></script>
    
    <title>Bangu Preschool Management System</title>
  </head>
  <body>
    <section class="main-web-box">
      <div class="web-content">
        <!-- ******* HEADER SECTION ******* -->
        <div class="header-section">
          <div class="logo">
            <i class='bx bxs-baby'></i>
            <span>Bangu Preschool Management</span>
          </div>

          <div class="menu">
            <ul>
              <li><a class="active" href="index.html">Home</a></li>
              <li><a href="about.html">About</a></li>
              <li><a href="contact.html">Contact</a></li>
            </ul>
          </div>

          <div class="user-profile">
            <i class='bx bx-user-circle'></i>
            <span>Guest</span>
          </div>
        </div>

        <!-- ******* WELCOME SECTION ******* -->
        <div class="welcome-section">
          <div class="welcome-content">
            <div class="welcome-text">
              <h1>Welcome to</h1>
              <h2>Bangu Preschool</h2>
              <p>Nurturing Young Minds, Building Bright Futures</p>
              <p class="subtitle">Where Learning Begins with Love and Care</p>
            </div>
            
            <div class="welcome-image">
              <img src="https://png.pngtree.com/png-clipart/20230824/original/pngtree-cute-children-playing-in-preschool-picture-image_8322807.png" alt="Preschool Children"/>
            </div>
          </div>
        </div>

        <!-- ******* MANAGEMENT OPTIONS SECTION ******* -->
        <div class="options-section">
          <h2 class="section-title">What We Offer</h2>
          
          <div class="features-grid">
            <!-- Child Care Features -->
            <div class="feature-card">
              <div class="feature-icon">
                <i class='bx bxs-heart'></i>
              </div>
              <h3>Loving Care</h3>
              <p>Professional caregivers who treat every child with love and attention</p>
            </div>

            <!-- Educational Programs -->
            <div class="feature-card">
              <div class="feature-icon">
                <i class='bx bxs-book-reader'></i>
              </div>
              <h3>Educational Programs</h3>
              <p>Age-appropriate learning activities that prepare children for their future</p>
            </div>

            <!-- Safe Environment -->
            <div class="feature-card">
              <div class="feature-icon">
                <i class='bx bxs-shield-alt-2'></i>
              </div>
              <h3>Safe Environment</h3>
              <p>Secure and child-proofed facilities with constant supervision</p>
            </div>

            <!-- Healthy Meals -->
            <div class="feature-card">
              <div class="feature-icon">
                <i class='bx bxs-bowl-hot'></i>
              </div>
              <h3>Nutritious Meals</h3>
              <p>Healthy, balanced meals and snacks prepared fresh daily</p>
            </div>

            <!-- Parent Communication -->
            <div class="feature-card">
              <div class="feature-icon">
                <i class='bx bxs-message-dots'></i>
              </div>
              <h3>Parent Updates</h3>
              <p>Regular communication about your child's daily activities and progress</p>
            </div>

            <!-- Development Tracking -->
            <div class="feature-card">
              <div class="feature-icon">
                <i class='bx bxs-trophy'></i>
              </div>
              <h3>Growth Tracking</h3>
              <p>Monitor and celebrate your child's developmental milestones</p>
            </div>
          </div>
        </div>

        <!-- ******* LOGIN SECTION ******* -->
        <div class="login-section">
          <h2 class="section-title">Quick Access Portal</h2>
          <div class="login-options">
            <div class="login-card">
              <i class='bx bxs-crown'></i>
              <h3>Super Admin</h3>
              <p>Ultimate system control and global management</p>
              <button class="login-btn super-admin-btn" onclick="openLoginModal('super-admin')">Login as Super Admin</button>
            </div>
            
            <div class="login-card">
              <i class='bx bxs-user-circle'></i>
              <h3>Director Login</h3>
              <p>Full preschool management and administration</p>
              <button class="login-btn admin-btn" onclick="openLoginModal('admin')">Login as Director</button>
            </div>
            
            <div class="login-card">
              <i class='bx bxs-heart'></i>
              <h3>Teacher Login</h3>
              <p>Access child profiles and daily activity tools</p>
              <button class="login-btn teacher-btn" onclick="openLoginModal('teacher')">Login as Teacher</button>
            </div>
            
            <div class="login-card">
              <i class='bx bxs-group'></i>
              <h3>Parent Login</h3>
              <p>View your child's daily activities and progress</p>
              <button class="login-btn parent-btn" onclick="openLoginModal('parent')">Login as Parent</button>
            </div>
          </div>
        </div>

        <!-- ******* LOGIN MODAL ******* -->
        <div id="loginModal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="modalTitle">Login Required</h3>
              <span class="close" onclick="closeLoginModal()">&times;</span>
            </div>
            
            <div class="modal-body">
              <div class="login-form-container">
                <div class="role-icon">
                  <i id="roleIcon" class='bx bxs-user'></i>
                </div>
                
                <form id="loginForm" class="login-form">
                  <div class="form-group">
                    <label for="username">User ID</label>
                    <input type="text" id="username" name="username" placeholder="Enter your ID (e.g., T001, AD01, STU0001)" required>
                    <i class='bx bx-user'></i>
                  </div>
                  
                  <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="Enter your password" required>
                    <i class='bx bx-lock-alt' id="togglePassword"></i>
                  </div>
                  
                  <div class="form-options">
                    <label class="remember-me">
                      <input type="checkbox" id="rememberMe">
                      <span class="checkmark"></span>
                      Remember me
                    </label>
                    <a href="#" class="forgot-password">Forgot password?</a>
                  </div>
                  
                  <div class="login-actions">
                    <button type="button" class="cancel-btn" onclick="closeLoginModal()">Cancel</button>
                    <button type="submit" class="submit-btn">Login</button>
                  </div>
                </form>
                
                <div class="login-help">
                  <p><strong>Demo Credentials:</strong></p>
                  <div class="demo-credentials">
                    <p><strong>Super Admin:</strong> SUPER001 / admin123</p>
                    <p><strong>Director:</strong> DIR001 / director123</p>
                    <p><strong>Teacher:</strong> TEACH001 / teacher123</p>
                    <p><strong>Parent:</strong> PAR001 / parent123</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ******* FOOTER SECTION ******* -->
        <div class="footer-section">
          <div class="footer-content">
            <div class="footer-info">
              <h3>Little Stars Preschool</h3>
              <p>Nurturing young minds with love, care, and early childhood education excellence. Creating a safe and stimulating environment for children to grow and learn.</p>
            </div>
            
            <div class="contact-info">
              <h4>Contact Information</h4>
              <p><i class='bx bx-phone'></i> +1 (555) 123-KIDS</p>
              <p><i class='bx bx-envelope'></i> info@littlestars.edu</p>
              <p><i class='bx bx-map'></i> 123 Rainbow Avenue, Learning City</p>
              <p><i class='bx bx-time'></i> Mon-Fri: 7:00 AM - 6:00 PM</p>
            </div>
            
            <div class="social-section">
              <h4>Connect With Us</h4>
              <div class="social-icons">
                <a href="#"><i class='bx bxl-facebook'></i></a>
                <a href="#"><i class='bx bxl-instagram'></i></a>
                <a href="#"><i class='bx bxl-youtube'></i></a>
                <a href="#"><i class='bx bx-envelope'></i></a>
              </div>
            </div>
          </div>
          
          <div class="footer-bottom">
            <p>&copy; 2025 Little Stars Preschool. All rights reserved. | Licensed Childcare Provider</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ******* JAVASCRIPT ******* -->
    <script type="module">
      // Add interactivity to feature cards
      const featureCards = document.querySelectorAll('.feature-card');
      featureCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-10px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0) scale(1)';
        });
      });

      // Login credentials for each role (Demo Mode)
      const credentials = {
        'super-admin': { 
          username: 'SUPER001', 
          password: 'admin123', 
          redirect: 'super-admin/dashboard.html',
          displayName: 'System Administrator'
        },
        'admin': { 
          username: 'DIR001', 
          password: 'director123', 
          redirect: 'admin/dashboard.html',
          displayName: 'School Director'
        },
        'teacher': { 
          username: 'TEACH001', 
          password: 'teacher123', 
          redirect: 'teacher/dashboard.html',
          displayName: 'Teacher'
        },
        'parent': { 
          username: 'PAR001', 
          password: 'parent123', 
          redirect: 'parent/dashboard.html',
          displayName: 'Parent'
        }
      };

      let currentRole = '';

      // Modal functions
      function openLoginModal(role) {
        currentRole = role;
        const modal = document.getElementById('loginModal');
        const modalTitle = document.getElementById('modalTitle');
        const roleIcon = document.getElementById('roleIcon');
        
        // Set role-specific content
        const roleConfig = {
          'super-admin': { title: 'Super Admin Login', icon: 'bxs-crown' },
          'admin': { title: 'Director Login', icon: 'bxs-user-circle' },
          'teacher': { title: 'Teacher Login', icon: 'bxs-heart' },
          'parent': { title: 'Parent Login', icon: 'bxs-group' }
        };
        
        modalTitle.textContent = roleConfig[role].title;
        roleIcon.className = `bx ${roleConfig[role].icon}`;
        
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
        
        // Focus on username field
        setTimeout(() => {
          document.getElementById('username').focus();
        }, 100);
      }

      function closeLoginModal() {
        const modal = document.getElementById('loginModal');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        
        // Clear form
        document.getElementById('loginForm').reset();
        currentRole = '';
      }

      // Close modal when clicking outside
      window.onclick = function(event) {
        const modal = document.getElementById('loginModal');
        if (event.target === modal) {
          closeLoginModal();
        }
      }

      // Password toggle functionality
      document.getElementById('togglePassword').addEventListener('click', function() {
        const passwordField = document.getElementById('password');
        const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordField.setAttribute('type', type);
        
        // Toggle icon
        this.className = type === 'password' ? 'bx bx-lock-alt' : 'bx bx-show';
      });

      // Simple authentication function
      async function authenticate(userId, password) {
        try {
          // Use the SQLite database for authentication if available
          if (typeof database !== 'undefined') {
            const authResult = await database.authenticateUser(userId, password);
            
            if (authResult.success) {
              const user = authResult.user;
              const authUser = {
                uid: user.id || `db_${Date.now()}`,
                userId: user.user_id,
                displayName: user.name,
                role: user.role,
                email: user.email,
                accessToken: `sqlite_token_${Date.now()}`
              };
              
              localStorage.setItem('currentUser', JSON.stringify(authUser));
              localStorage.setItem('userRole', user.role);
              return { success: true, user: authUser };
            }
          }
          
          // Fallback to demo credentials
          const role = Object.keys(credentials).find(key => 
            credentials[key].username === userId && credentials[key].password === password
          );
          
          if (role) {
            const user = {
              uid: `demo_${Date.now()}`,
              userId: userId,
              displayName: credentials[role].displayName,
              role: role,
              accessToken: `demo_token_${Date.now()}`
            };
            
            localStorage.setItem('currentUser', JSON.stringify(user));
            localStorage.setItem('userRole', role);
            
            return { success: true, user };
          } else {
            throw new Error('Invalid user ID or password');
          }
        } catch (error) {
          return { success: false, error: error.message };
        }
      }

      // Form submission with Firebase integration
      document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const rememberMe = document.getElementById('rememberMe').checked;
        const submitBtn = this.querySelector('button[type="submit"]');
        
        // Show loading state
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Authenticating...';
        submitBtn.disabled = true;
        
        try {
          // Authenticate user
          const authResult = await authenticate(username, password);
          
          if (authResult.success) {
            // Show success message
            showLoginMessage('success', '‚úÖ Authentication Successful! Redirecting...');
            
            // Log authentication activity
            await logUserActivity(authResult.user.uid, 'login', {
              role: currentRole,
              timestamp: new Date().toISOString(),
              ip: await getUserIP()
            });
            
            // Store login state if remember me is checked
            if (rememberMe) {
              localStorage.setItem('rememberUser', JSON.stringify({
                role: currentRole,
                username: username,
                timestamp: Date.now()
              }));
            }
            
            // Redirect after delay
            setTimeout(() => {
              window.location.href = credentials[currentRole].redirect;
            }, 2000);
          } else {
            showLoginMessage('error', `‚ùå Authentication failed: ${authResult.error}`);
            
            // Clear password field
            document.getElementById('password').value = '';
            document.getElementById('password').focus();
          }
        } catch (error) {
          showLoginMessage('error', `‚ùå Connection error: ${error.message}`);
        } finally {
          // Restore button state
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        }
      });

      // User activity logging
      async function logUserActivity(userId, action, details) {
        try {
          const activity = {
            userId,
            action,
            details,
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent
          };
          
          // In production, save to SQLite database:
          // await database.logUserActivity(activity);
          
          // Demo mode - save to localStorage
          const activities = JSON.parse(localStorage.getItem('userActivities') || '[]');
          activities.unshift(activity);
          localStorage.setItem('userActivities', JSON.stringify(activities.slice(0, 100)));
          
          console.log('ÔøΩ SQLite Activity Logged:', activity);
        } catch (error) {
          console.error('Error logging activity:', error);
        }
      }

      // Get user IP for security logging
      async function getUserIP() {
        try {
          const response = await fetch('https://api.ipify.org?format=json');
          const data = await response.json();
          return data.ip;
        } catch (error) {
          return 'unknown';
        }
      }

      function showLoginMessage(type, message) {
        // Remove existing messages
        const existingMessage = document.querySelector('.login-message');
        if (existingMessage) {
          existingMessage.remove();
        }
        
        // Create new message
        const messageDiv = document.createElement('div');
        messageDiv.className = `login-message ${type}`;
        messageDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px;">
            <i class='bx ${type === 'success' ? 'bxs-check-circle' : 'bxs-error'}'></i>
            <span>${message}</span>
          </div>
        `;
        
        // Insert message
        const formContainer = document.querySelector('.login-form-container');
        formContainer.insertBefore(messageDiv, document.getElementById('loginForm'));
        
        // Auto remove error messages after 5 seconds
        if (type === 'error') {
          setTimeout(() => {
            if (messageDiv.parentNode) {
              messageDiv.remove();
            }
          }, 5000);
        }
      }

      // Check for remembered user on page load
      window.addEventListener('load', function() {
        const rememberedUser = localStorage.getItem('rememberUser');
        if (rememberedUser) {
          const userData = JSON.parse(rememberedUser);
          const dayInMs = 24 * 60 * 60 * 1000; // 24 hours
          
          // Check if stored data is less than 24 hours old
          if (Date.now() - userData.timestamp < dayInMs) {
            console.log(`üî• Welcome back! Last session: ${userData.role}`);
          } else {
            // Remove expired data
            localStorage.removeItem('rememberUser');
          }
        }
        
        // Show SQLite ready message
        setTimeout(() => {
          console.log('ÔøΩ SQLite Database System Ready!');
          console.log('üì± Demo credentials available in login modal');
          console.log('üîê Production-ready for local database storage');
        }, 1000);
        
        // Welcome animation
        const welcomeText = document.querySelector('.welcome-text');
        const welcomeImage = document.querySelector('.welcome-image');
        
        setTimeout(() => {
          welcomeText.style.opacity = '1';
          welcomeText.style.transform = 'translateX(0)';
        }, 500);
        
        setTimeout(() => {
          welcomeImage.style.opacity = '1';
          welcomeImage.style.transform = 'translateX(0)';
        }, 800);
      });

      // Escape key to close modal
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeLoginModal();
        }
      });

      // Forgot password functionality
      document.querySelector('.forgot-password').addEventListener('click', function(e) {
        e.preventDefault();
        alert('ÔøΩ SQLite Password Recovery\n\nFor password reset, contact:\nüìß admin@bangu.edu\nüìû (555) 123-KIDS\n\nIn production, implement password reset functionality.');
      });

      // Make functions available globally
      window.openLoginModal = openLoginModal;
      window.closeLoginModal = closeLoginModal;
    </script>
  </body>
</html>
